#!/usr/bin/env php
<?php
use Laminas\Mvc\Application as LaminasApplication;
use Laminas\Stdlib\ArrayUtils;
use Symfony\Component\Console\Application as SymfonyConsoleApplication;
use Symfony\Component\Console\CommandLoader\ContainerCommandLoader;

require __DIR__ . '/../../../autoload.php';

$configPath = __DIR__ . '/../../../../config';

$appConfig = require $configPath . '/application.config.php';

if (file_exists($configPath . '/development.config.php'))
{
	$appConfig = ArrayUtils::merge($appConfig, require $configPath . '/development.config.php');
}

$laminasApp = LaminasApplication::init($appConfig);

$config = $laminasApp->getConfig();

$container = $laminasApp->getServiceManager();

$app = new SymfonyConsoleApplication($config['console']['name'] ?? '');

foreach ($config['console']['commands'] as $commandClass)
{
	$app->add(
		$container->get($commandClass)
	);
}

$app->run();